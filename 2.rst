=============================
第2部 基本的なPillowの使い方
=============================

第2部では、より実用的なスクリプト開発向けて、公開されたサードパーティのパッケージを使う方法を学びます。

また、実際にサードパーティのパッケージをインストールし、Python コードから利用してみましょう。

題材とする **Pillow** はサードパーティのパッケージのひとつで、画像処理を行うライブラリです。

pipを使ってみよう
=================

サードパーティパッケージは、
**pip** というコマンドを用いて自分の環境にインストールことができます。
これは、PHPの ``composer`` コマンドやJavaScriptの ``npm`` コマンドに相当します。

pipでインストールできるサードパーティのパッケージは、
**Python Package Index** (PyPI: https://pypi.python.org/pypi) に登録されています。

PyPIには、DjangoやFlaskといったWeb開発のためのフレームワークをはじめ、
numpyなどの数値計算ライブラリやプロビジョニングツールのAnsibleなど、
様々なパッケージが登録されており、pipで簡単にインストールすることができます。

もちろんPillowもPyPIに登録されているのでpipでインストールすることができます。

pipのインストール
-----------------

ではpipはどのようにインストールするのでしょう。

pipのインストール方法はOSによって異なります。

:Ubuntu: get-pip.py
:Windows/OSX: ensurepip

Windows/OSX
~~~~~~~~~~~

実は Windows/OSX の場合、
Pythonをインストールした際にpipも一緒にインストールされています。

以下のコマンドを実行し、pipがインストールされていることを確認してみましょう。

::

  C:\Users\pyconjp> pip --version
  pip 8.1.1 from c:\users\pyconjp\appdata\local\programs\python\python35-32\lib\site-packages (python 3.5)

.. warning::

  ただし、Pythonの公式 (python.org) のインストーラでインストールした場合以外はこの限りではありません。

.. todo:: ensurepip の説明どうしよう

Ubuntu
~~~~~~

Ubuntuにpipをインストールするには、PyPIが配布している ``get-pip.py`` というインストールスクリプトを用います。

以下のコマンドでpipをインストールします。

::

  $ curl https://bootstrap.pypa.io/get-pip.py | sudo python3
  $ pip --version
  pip 8.1.2 from /usr/local/lib/python3.4/dist-packages (python 3.4)

.. caution::

  ``python`` コマンドではなく ``python3`` コマンドを使うことに注意してください。
  ``python`` コマンドを使うと、 Python 2 用に pip がインストールされてしまいます。


このままだとpipでパッケージインストール時にsudoが必要となるので、
ホームディレクトリ下のパッケージインストール用ディレクトリにインストールされるように設定します

::

  $ mkdir -p ~/.config/pip/
  $ echo -e '[install]\nuser = yes' > ~/.config/pip/pip.conf

これでインストールは完了です

pipのバージョン確認
-------------------

次に、pipが正しくインストールされているかを確認しましょう

先ほどと繰り返しになりますが、以下のコマンドを実行してください

::

  $ pip --version
  pip 8.1.2 from /usr/local/lib/python3.4/dist-packages (python 3.4)

この出力はそれぞれ次のような意味です

- ``pip 8.1.2`` pip のバージョン
- ``from /usr/local/lib/python3.4/dist-packages`` pipでインストールされたパッケージが配置されるディレクトリ・フォルダ
- ``(python 3.4)`` pip が動いてるPythonインタプリタのバージョン

出力から、以下のことが確認できれば、無事にpipがインストールできています

- pip のバージョンが 8 以上 (``8.0.0``, ``8.1.2`` など)
- Python のバージョンが 3.4 または 3.5

.. todo:: え！？問題があった！？その時は呼んでください


Pillowをインストールしよう
==========================

pipがインストールできたので、実際にパッケージをインストールしてみましょう。

今回は、Pillowという画像処理用のライブラリをインストールします。

Pillowは画像処理を行うライブラリで、画像の縮小や切り取りをはじめ、
様々な画像編集を行うことができます。

.. todo:: 作例とかあるといいかも

Pillowは ``pip install`` コマンドでインストールすることができます。

以下のコマンドを実行してください。

::

  $ pip install Pillow

では、インストールができたことを確認してみましょう。
インストールされているパッケージを確認するには、 ``pip freeze`` コマンドを実行します

::

  $ pip freeze
  Pillow==3.3.1

``==`` の左側がインストールしたパッケージ名、右側がパッケージのバージョンです。
Pillow がインストールされていれば、上記のような表示が得られます。

.. note::

  インストールしたタイミングによってはバージョンが異なる場合がありますが問題ありません。

.. note::

  インストールしたパッケージを削除するには、 ``pip uninstall パッケージ名`` というコマンド使います。
  例えば、 Pillow を削除するには ``pip uninstall Pillow`` とします。

  参考: https://pip.pypa.io/en/stable/user_guide/

画像を読み込んでみよう
======================

.. todo::

  - バイナリモードでのファイルオープン
  - Pillow の import
  - 開いた画像ファイルを Pillow に読み込ませるには

    - Pillow に読み込ませたことを確認するため、
      Pillow の API で画像のサイズとか出してみる

.. note::

  この話 ``import PIL`` が出てきたとこに書いておこう

  PIL(Python Imaging Library)はPillowの分岐（フォーク）元のライブラリです。
  PILは長らく開発が停滞しており、PillowはPILをフォークし開発を後継しています。




画像を保存してみよう
=====================

.. 書き出すだけだと、内容が薄すぎるかも

.. todo::

  - 開いた画像データをファイルに書き出す


画像を縮小してみよう
====================

.. todo::

  - 画像を縮小するには
  - 画像を開いて縮小して保存するところまで通しで行う



.. Handbook のリンクあるとあとで便利かな
.. https://pillow.readthedocs.io/en/3.3.x/handbook/index.html
